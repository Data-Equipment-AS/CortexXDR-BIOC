65e43ff91fd1a7731f0200a3ff641e9d
[{"rule_id":532,"global_rule_id":"NO_ID","mssp_global_rule_id":null,"insert_time":1663237714285,"modify_time":1663329406510,"severity":"SEV_030_MEDIUM","source":"filip.fog@dataequipment.no","comment":"https:\/\/www-bleepingcomputer-com.cdn.ampproject.org\/c\/s\/www.bleepingcomputer.com\/news\/security\/microsoft-teams-stores-auth-tokens-as-cleartext-in-windows-linux-macs\/amp\/","status":"ENABLED","category":"FILE_PRIVILEGE_MANIPULATION","indicator":{"investigation":{"FILE_EVENT":{"filter":{"AND":[{"AND":[{"SEARCH_FIELD":"actor_process_image_name","SEARCH_TYPE":"NCONTAINS","SEARCH_VALUE":"Teams"},{"SEARCH_FIELD":"actor_process_image_name","SEARCH_TYPE":"NCONTAINS","SEARCH_VALUE":"teams"},{"OR":[{"SEARCH_FIELD":"action_file_path","SEARCH_TYPE":"CONTAINS","SEARCH_VALUE":"\\Microsoft\\Teams\\Cookies"},{"SEARCH_FIELD":"action_file_path","SEARCH_TYPE":"CONTAINS","SEARCH_VALUE":"Microsoft\\Teams\\Local Storage\\leveldb"},{"SEARCH_FIELD":"action_file_path","SEARCH_TYPE":"CONTAINS","SEARCH_VALUE":"\/Library\/Application Support\/Microsoft\/Teams\/Cookies"},{"SEARCH_FIELD":"action_file_path","SEARCH_TYPE":"CONTAINS","SEARCH_VALUE":"\/Library\/Application Support\/Microsoft\/Teams\/Local Storage\/leveldb"},{"SEARCH_FIELD":"action_file_path","SEARCH_TYPE":"CONTAINS","SEARCH_VALUE":"\/.config\/Microsoft\/Microsoft Teams\/Cookies"},{"SEARCH_FIELD":"action_file_path","SEARCH_TYPE":"CONTAINS","SEARCH_VALUE":"\/.config\/Microsoft\/Microsoft Teams\/Local Storage\/leveldb"}]}]}]}}},"investigationType":"FILE_EVENT"},"indicator_md5":"2b371e0c8fc3a21dc5eb6c6662dea42c","indicator_text":"dataset = xdr_data |\r\nfilter event_type = FILE and (\r\n    actor_process_image_name not contains \"Teams\" and \r\n    actor_process_image_name not contains \"teams\"\r\n)\r\nand (\r\n    action_file_path contains \"\\Microsoft\\Teams\\Cookies\" or\r\n    action_file_path contains \"Microsoft\\Teams\\Local Storage\\leveldb\" or \r\n    action_file_path contains \"\/Library\/Application Support\/Microsoft\/Teams\/Cookies\" or \r\n    action_file_path contains \"\/Library\/Application Support\/Microsoft\/Teams\/Local Storage\/leveldb\" or \r\n    action_file_path contains \"\/.config\/Microsoft\/Microsoft Teams\/Cookies\" or \r\n    action_file_path contains \"\/.config\/Microsoft\/Microsoft Teams\/Local Storage\/leveldb\"\r\n)","name":"Unsecured Access Tokens - MS Teams","mitre_technique_id_and_name":"T1552 - Unsecured Credentials|T1552.001 - Unsecured Credentials: Credentials In Files","mitre_tactic_id_and_name":"TA0006 - Credential Access","mitre_tactic_id":"TA0006","mitre_technique_id":"T1552|T1552.001","btp_rule":{"AGENT_OS_WINDOWS":{"signatureConfiguration":{"default":{"settings":{"action":"block","friendlyName":"Unsecured Access Tokens - MS Teams","tactic_id":["TA0006"],"technique_id":["T1552","T1552.001"],"biocRuleName":"Unsecured Access Tokens - MS Teams","biocId":532,"additionalData":"{}"}}},"rule_data":"(deftemplate file_operation_532 (slot cid)) (defrule file_operation_532 (process_start (cid ?cid) (instance_id ?parent_instance_id) (process_image_name ?act_process_image_name &: (or (not (contains ?act_process_image_name \"teams\")) (not (contains ?act_process_image_name \"teams\"))))) (file_operation (instance_id ?os_act_parent_instance_id) (actor_instance_id ?act_parent_instance_id) (cid ?cid) (file_path ?file_path &: (and (and (not (contains ?act_process_image_name \"teams\")) (eq ?act_parent_instance_id ?parent_instance_id)) (and (not (contains ?act_process_image_name \"teams\")) (eq ?act_parent_instance_id ?parent_instance_id)) (or (contains ?file_path \"\\\\microsoft\\\\teams\\\\cookies\") (contains ?file_path \"microsoft\\\\teams\\\\local storage\\\\leveldb\") (contains ?file_path \"\/library\/application support\/microsoft\/teams\/cookies\") (contains ?file_path \"\/library\/application support\/microsoft\/teams\/local storage\/leveldb\") (contains ?file_path \"\/.config\/microsoft\/microsoft teams\/cookies\") (contains ?file_path \"\/.config\/microsoft\/microsoft teams\/local storage\/leveldb\"))))) (not (file_operation_532 (cid ?cid))) => (assert (file_operation_532 (cid ?cid))))"}},"btp_rule_name":"file_operation_532","is_preventable":1,"supported_os":1,"btp_validation_error":"WINDOWS_SUPPORT_ONLY","xql":"{\"tables\": [\"xdr_data\"], \"stages\": [{\"FILTER\": {\"filter\": {\"AND\": [{\"AND\": [{\"LEFT\": \"$event_type\", \"OPERATOR\": \"EQ\", \"RIGHT\": \"$FILE\", \"FILTER_DIALECT\": \"EXTENDED_FILTER_OBJ\"}, {\"AND\": [{\"LEFT\": \"$actor_process_image_name\", \"OPERATOR\": \"NCONTAINS\", \"RIGHT\": \"Teams\", \"FILTER_DIALECT\": \"EXTENDED_FILTER_OBJ\"}, {\"LEFT\": \"$actor_process_image_name\", \"OPERATOR\": \"NCONTAINS\", \"RIGHT\": \"teams\", \"FILTER_DIALECT\": \"EXTENDED_FILTER_OBJ\"}]}]}, {\"OR\": [{\"OR\": [{\"OR\": [{\"OR\": [{\"OR\": [{\"LEFT\": \"$action_file_path\", \"OPERATOR\": \"CONTAINS\", \"RIGHT\": \"\\\\Microsoft\\\\Teams\\\\Cookies\", \"FILTER_DIALECT\": \"EXTENDED_FILTER_OBJ\"}, {\"LEFT\": \"$action_file_path\", \"OPERATOR\": \"CONTAINS\", \"RIGHT\": \"Microsoft\\\\Teams\\\\Local Storage\\\\leveldb\", \"FILTER_DIALECT\": \"EXTENDED_FILTER_OBJ\"}]}, {\"LEFT\": \"$action_file_path\", \"OPERATOR\": \"CONTAINS\", \"RIGHT\": \"\/Library\/Application Support\/Microsoft\/Teams\/Cookies\", \"FILTER_DIALECT\": \"EXTENDED_FILTER_OBJ\"}]}, {\"LEFT\": \"$action_file_path\", \"OPERATOR\": \"CONTAINS\", \"RIGHT\": \"\/Library\/Application Support\/Microsoft\/Teams\/Local Storage\/leveldb\", \"FILTER_DIALECT\": \"EXTENDED_FILTER_OBJ\"}]}, {\"LEFT\": \"$action_file_path\", \"OPERATOR\": \"CONTAINS\", \"RIGHT\": \"\/.config\/Microsoft\/Microsoft Teams\/Cookies\", \"FILTER_DIALECT\": \"EXTENDED_FILTER_OBJ\"}]}, {\"LEFT\": \"$action_file_path\", \"OPERATOR\": \"CONTAINS\", \"RIGHT\": \"\/.config\/Microsoft\/Microsoft Teams\/Local Storage\/leveldb\", \"FILTER_DIALECT\": \"EXTENDED_FILTER_OBJ\"}]}]}}}]}","is_xql":true,"query_tables":"[\"xdr_data\"]","rule_indicator_last_modified_ts":1663329316677}]